<nav class="text-sm mb-6 text-gray-500">
  <ol class="flex items-center space-x-2">
    <li>
      <a href="/admin/dashboard" class="hover:underline text-gray-600">Admin</a>
    </li>
    <li>/</li>
    <li class="text-gray-800 font-medium">Brand Management</li>
  </ol>
</nav>

<!-- Top Bar -->
<div class="flex justify-between items-center mb-8 mt-10">
  <h1 class="text-xl font-semibold">Brand Management</h1>
  <button id="openModalBtn" class="bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700">
    + Add Brand
  </button>
</div>

<!-- Modal -->
<div id="brandModal" class="hidden fixed inset-0 flex items-center justify-center bg-black bg-opacity-50">
  <div class="bg-white p-6 rounded-lg w-1/3">
    <h2 class="text-lg font-semibold mb-4">Add New Brand</h2>
    <form id="addBrandForm" enctype="multipart/form-data">
      <label class="block mb-2">Brand Name</label>
      <input type="text" name="name" class="border p-2 w-full mb-4" required>

      <label class="block mb-2">Brand Logo</label>
      <input type="file" name="logo_url" class="mb-4">

      <div class="flex justify-end">
        <button type="button" id="closeModalBtn" class="mr-2 px-4 py-2 border rounded">Cancel</button>
        <button type="submit" class="bg-blue-600 text-white px-4 py-2 rounded">Add</button>
      </div>
    </form>
  </div>
</div>

<!-- Brand Table -->
<div class="bg-white shadow-md rounded-lg overflow-hidden">
  <table class="w-full text-left">
    <thead class="bg-gray-200 text-gray-600">
      <tr>
        <th class="py-3 px-4">S.No</th>
        <th class="py-3 px-4">Brand</th>
        <th class="py-3 px-4">Logo</th>
        <th class="py-3 px-4">Status</th>
        <th class="py-3 px-4">Actions</th>
      </tr>
    </thead>
    <tbody>
  <% brands.forEach((brand, index)=> { %>
    <tr class="border-b <%= brand.is_deleted ? 'opacity-50' : '' %>">
      <td class="py-3 px-4"><%= index + 1 %></td>
      <td class="py-3 px-4"><%= brand.name %></td>
      <td class="py-3 px-4">
        <% if (brand.logo_url) { %>
          <img src="<%= brand.logo_url %>" class="w-12 h-12 object-contain">
        <% } else { %>
          <span class="text-gray-400 italic">No Logo</span>
        <% } %>
      </td>
      <td class="py-3 px-4">
        <button disabled
          class="px-4 py-1 rounded-full text-white text-sm font-medium cursor-default 
            <%= brand.is_active ? 'bg-green-500' : 'bg-gray-400' %>">
          <%= brand.is_active ? 'Active' : 'Inactive' %>
        </button>
      </td>
      <td class="py-3 px-4">
        <button onclick="toggleBrand('<%= brand._id %>')" 
                class="bg-orange-400 text-white px-3 py-1 rounded hover:bg-orange-500">
          <%= brand.is_active ? 'Block' : 'Unblock' %>
        </button>

        <% if (brand.is_delete) { %>
          <button onclick="restoreBrand('<%= brand._id %>')" 
                  class="bg-green-500 text-white px-3 py-1 rounded hover:bg-green-600">
            Restore
          </button>
        <% } else { %>
          <button onclick="deleteBrand('<%= brand._id %>')" 
                  class="bg-red-500 text-white px-3 py-1 rounded hover:bg-red-600">
            Delete
          </button>
        <% } %>
      </td>
    </tr>
  <% }) %>
</tbody>

  </table>
</div>

<script>
  const modal = document.getElementById('brandModal')
  document.getElementById('openModalBtn').onclick = () => modal.classList.remove('hidden')
  document.getElementById('closeModalBtn').onclick = () => modal.classList.add('hidden')

  // AJAX Submit
  document.getElementById('addBrandForm').onsubmit = async (e) => {
    e.preventDefault()
    const formData = new FormData(e.target)
    const res = await fetch('/admin/brands', { method: 'POST', body: formData })
    const data = await res.json()

    if(data.success){
      Swal.fire({ icon:'success', title:'Brand Added', text:data.message, timer:1500, showConfirmButton:false })
        .then(()=> location.reload())
    } else {
      Swal.fire({ icon:'error', title:'Error', text:data.message })
    }
  }

  // Toggle Brand (Activate/Block)
  async function toggleBrand(id) {
    try {
      const res = await fetch(`/admin/brands/${id}/status`, { method: 'PATCH' })
      const data = await res.json()
      if(data.success){
        Swal.fire({ icon:'success', title:data.message, timer:1500, showConfirmButton:false })
          .then(()=> location.reload())
      } else {
        Swal.fire({ icon:'error', title:'Error', text:data.message })
      }
    } catch {
      Swal.fire({ icon:'error', title:'Server Error' })
    }
  }

  async function deleteBrand(id) {
  Swal.fire({
    title: 'Are you sure?',
    text: 'This will delete the brand!',
    icon: 'warning',
    showCancelButton: true,
    confirmButtonColor: '#d33',
    cancelButtonColor: '#3085d6',
    confirmButtonText: 'Yes, delete it!'
  }).then(async (result) => {
    if (result.isConfirmed) {
      const res = await fetch(`/admin/brands/${id}`, { method: 'DELETE' })
      const data = await res.json()
      if (data.success) {
        Swal.fire({ icon: 'success', title: data.message, timer: 1500, showConfirmButton: false })
          .then(() => location.reload())
      }
    }
  })
}

async function restoreBrand(id) {
  const res = await fetch(`/admin/brands/${id}/restore`, { method: 'PATCH' })
  const data = await res.json()
  if (data.success) {
    Swal.fire({ icon: 'success', title: data.message, timer: 1500, showConfirmButton: false })
      .then(() => location.reload())
  }
}

</script>

