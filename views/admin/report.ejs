<div class="p-6">
    <nav class="flex items-center text-sm text-gray-500 mb-6">
        <a href="/admin/dashboard" class="hover:text-gray-800 transition">Admin</a>
        <span class="mx-2">/</span>
        <span class="text-gray-800 font-semibold">Sales Report</span>
    </nav>

    
  <!-- Header -->
    <div class="mb-8 mt-8">

        <!-- Title (full row) -->
        <h1 class="text-2xl font-bold text-gray-800 mb-4">Sales Report</h1>

        <!-- Buttons aligned to the right -->
        <div class="flex justify-end gap-3">
            <a href="/admin/salesreport/pdf?<%= new URLSearchParams(query).toString() %>" 
            class="bg-red-600 text-white px-4 py-2 rounded-lg hover:bg-red-700">
            Download PDF
            </a>

            <a href="/admin/salesreport/excel?<%= new URLSearchParams(query).toString() %>" 
            class="bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700">
            Download Excel
            </a>
        </div>

    </div>



  <!-- Top Summary Cards -->
  <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
    
    <div class="bg-white shadow-md rounded-lg p-6">
      <p class="text-gray-600">Total Orders</p>
      <h2 class="text-3xl font-bold mt-2"><%= totalOrders %></h2>
    </div>

    <div class="bg-white shadow-md rounded-lg p-6">
      <p class="text-gray-600">Total Revenue</p>
      <h2 class="text-3xl font-bold mt-2">₹<%= totalRevenue.toFixed(2) %></h2>
    </div>

    <div class="bg-white shadow-md rounded-lg p-6">
      <p class="text-gray-600">Total Discount</p>
      <h2 class="text-3xl font-bold mt-2">₹<%= totalDiscount.toFixed(2) %></h2>
    </div>

  </div>


<!-- Filters -->
<div class="bg-white shadow-md rounded-lg p-6 mb-8">
  <h2 class="text-lg font-semibold mb-4">Filters</h2>

  <form id="filterForm" method="GET" action="/admin/salesreport">

    <!-- Row 1: Dropdown -->
    <div class="w-full md:w-1/3 mb-4">
      <label class="block text-gray-600 mb-1">Filter Type</label>
      <select id="filterType" name="filterType" 
              class="w-full border rounded-lg px-3 py-2 focus:outline-none">
        <option value="daily" <%= filterType === "daily" ? "selected" : "" %>>Daily</option>
        <option value="weekly" <%= filterType === "weekly" ? "selected" : "" %>>Weekly</option>
        <option value="monthly" <%= filterType === "monthly" ? "selected" : "" %>>Monthly</option>
        <option value="custom" <%= filterType === "custom" ? "selected" : "" %>>Custom</option>
      </select>
    </div>

    <!-- Row 2: Custom Date Range (Hidden unless selected) -->
    <div id="customDateBox" class="hidden mt-6 mb-6">
      <label class="block text-gray-600 mb-1">Select Date Range</label>
      <div class="flex flex-col md:flex-row gap-4">
        <input type="date" name="from" value="<%= fromDate %>"
               class="border rounded-lg px-3 py-2 w-full md:w-1/2">

        <input type="date" name="to" value="<%= toDate %>"
               class="border rounded-lg px-3 py-2 w-full md:w-1/2">
      </div>
    </div>

    <!-- Row 3: Buttons BELOW date range -->
    <div class="flex gap-4 mt-4">
      <a href="/admin/salesreport" 
        class="px-4 py-2 bg-gray-200 rounded-lg hover:bg-gray-300">
        Reset
      </a>

      <button type="submit" 
              class="px-4 py-2 bg-black text-white rounded-lg hover:bg-gray-800">
        Apply Filter
      </button>
    </div>

  </form>
</div>


  <!-- Sales Report Table -->
  <div class="bg-white shadow-md rounded-lg p-6">

    <h2 class="text-xl font-semibold mb-8">Sales Report</h2>

    <table class="w-full text-left border-collapse">
      <thead>
        <tr class="border-b bg-gray-100">
          <th class="p-3">Order No.</th>
          <th class="p-3">User</th>
          <th class="p-3">Date</th>
          <th class="p-3">Total Amount</th>
          <th class="p-3">Discount</th>
          <th class="p-3">Final Amount</th>
          <th class="p-3">Payment Method</th>
        </tr>
      </thead>

<tbody>
  <% if (orders.length === 0) { %>
    <tr>
      <td colspan="7" class="text-center py-6 text-gray-500">
        No results found
      </td>
    </tr>
  <% } else { %>
    <% orders.forEach((order) => { %>
      <tr class="border-b">
        <!-- Order Number -->
        <td class="p-3"><%= order.orderNumber %></td>

        <!-- User Name -->
        <td class="p-3"><%= order.user ? order.user.name : "Unknown" %></td>

        <!-- Date (Created At) -->
        <td class="p-3"><%= order.createdAt.toLocaleDateString("en-IN") %></td>

        <!-- Total Amount (Subtotal + tax + shipping - discounts) -->
        <td class="p-3">₹<%= order.subtotal %></td>

        <!-- Total Discount -->
        <td class="p-3">₹<%= order.totalDiscount %></td>

        <!-- Final Amount (Whatever customer actually pays) -->
        <td class="p-3">₹<%= order.totalAmount %></td>

        <!-- Payment Method -->
        <td class="p-3"><%= order.paymentMethod %></td>
      </tr>
    <% }) %>
  <% } %>
</tbody>

    </table>

    <!-- Pagination (Your own system) -->
    <div id="paginationArea" class="mt-4">
      <!-- your pagination will be placed here -->
    </div>

  </div>
</div>

<%- include('../partials/pagination.ejs',{currentPage,totalPages,query}) %>

<script>
  // Show/Hide Custom Date Input
  document.getElementById("filterType").addEventListener("change", function () {
    const customBox = document.getElementById("customDateBox");

    if (this.value === "custom") {
      customBox.classList.remove("hidden");
    } else {
      customBox.classList.add("hidden");
    }
  });

    function toggleCustomDateBox() {
    const filterType = document.getElementById("filterType").value;
    const customBox = document.getElementById("customDateBox");

    if (filterType === "custom") {
      customBox.classList.remove("hidden");
    } else {
      customBox.classList.add("hidden");
    }
  }

  // On dropdown change
  document.getElementById("filterType").addEventListener("change", toggleCustomDateBox);

  // On page load (for when filter already set)
  window.addEventListener("DOMContentLoaded", toggleCustomDateBox);
</script>
