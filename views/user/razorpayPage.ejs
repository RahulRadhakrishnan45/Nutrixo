<div class="min-h-screen flex items-start justify-center bg-gray-50 pt-32 p-10">
  <div class="bg-white shadow-md rounded-lg p-10 text-center max-w-md w-full">
    
    <h2 class="text-2xl font-bold mb-4">Processing Payment...</h2>
    <p class="text-gray-600 mb-6">Please wait while we redirect you to the secure payment gateway.</p>

    <div class="flex justify-center">
      <div class="animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-black"></div>
    </div>

  </div>
</div>

<script src="https://checkout.razorpay.com/v1/checkout.js"></script>

<script>
const options = {
    key: "<%- key_id %>",
    amount: "<%- razorOrder.amount %>",
    currency: "INR",
    order_id: "<%- razorOrder.id %>",
    name: "My Store",

    handler: async function (response) {
        try {
            const res = await fetch("/checkout/verify", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json"
                },
                body: JSON.stringify({
                    razorpay_payment_id: response.razorpay_payment_id,
                    razorpay_order_id: response.razorpay_order_id,
                    razorpay_signature: response.razorpay_signature,
                    total: "<%- String(total) %>",
                    addressIndex: "<%- String(addressIndex) %>"
                })
            });

            const data = await res.json();

            if (data.success) {
                window.location.href = "/checkout/" + data.orderId + "/success";
            } else {
                window.location.href = "/checkout/<%- razorOrder.id %>/fail";
            }

        } catch (err) {
            console.error("Verification error:", err);
            window.location.href = "/checkout/<%- razorOrder.id %>/fail";
        }
    },

    modal: {
        ondismiss: function () {
            window.location.href = "/checkout/<%- razorOrder.id %>/fail";
        }
    }
};

const rzp1 = new Razorpay(options);

rzp1.on("payment.failed", function () {
    window.location.href = "/checkout/<%- razorOrder.id %>/fail";
});

window.onload = function () {
    rzp1.open();
};
</script>
