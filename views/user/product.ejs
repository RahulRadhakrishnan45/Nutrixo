<body class="bg-gray-100">
  <div class="container mx-auto px-4 sm:px-6 lg:px-8 py-8">

    <!-- Breadcrumb -->
    <nav class="text-sm mb-6 text-gray-500">
      <ol class="flex items-center space-x-2">
        <li>
          <a href="/" class="hover:underline text-gray-600">Home</a>
        </li>
        <li>/</li>
        <li class="text-gray-800 font-medium">Products</li>
      </ol>
    </nav>

    <!-- Layout: Sidebar + Products -->
    <div class="flex gap-12">
      
      <!-- Filters Sidebar -->
      <aside class="w-64 bg-white rounded-xl shadow p-6 hidden md:block">
        <h2 class="text-lg font-semibold mb-4">Categories</h2>
        <ul class="space-y-2">
          <li>
            <input type="radio" name="category" value="All"
                <%= !selectedFilters.category ? 'checked' : '' %>
                 class="mr-2"> All
          </li>
          <% categories.forEach(c => { %>
            <li>
              <input type="radio" name="category" value="<%= c %>"
                  <%= selectedFilters.category === c ? 'checked' : '' %>
                   class="mr-2"> <%= c %>
            </li>
          <% }) %>
        </ul>

        <div class="mt-6">
          <label class="block font-medium mb-2">Select Brand</label>
            <select class="w-full border rounded p-2" name="brand" >
                <option value="All" <%= !selectedFilters.brand ? 'selected' : '' %>>All</option>
                  <% brands.forEach(b => { %>
                  <option value="<%= b %>" <%= selectedFilters.brand === b ? 'selected' : '' %>><%= b %></option>
              <% }) %>
            </select>
        </div>

        <div class="mt-6">
          <label class="block font-medium mb-2">Select Flavour</label>
          <select class="w-full border rounded p-2" name="flavour" >
            <option value="All" <%= !selectedFilters.flavour ? 'selected' : '' %>>All</option>
                <% flavours.forEach(f => { %>
                <option value="<%= f %>" <%= selectedFilters.flavour === f ? 'selected' : '' %>><%= f %></option>
              <% }) %>
          </select>
        </div>

        <div class="mt-6">
          <label class="block font-medium mb-2">Select Weight</label>
          <select class="w-full border rounded p-2" name="size" >
            <option value="All" <%= !selectedFilters.size ? 'selected' : '' %>>All</option>
              <% sizes.forEach(s => { %>
              <option value="<%= s %>" <%= selectedFilters.size === s ? 'selected' : '' %>><%= s %></option>
            <% }) %>
          </select>
        </div>

        <div class="mt-6">
  <label class="block font-medium mb-2">Price Range</label>
    <div class="flex gap-2 items-center">
        <input type="number" id="minPrice" min="100" step="100" 
           class="w-1/2 border rounded p-2"
           placeholder="Min" 
           value="<%= selectedFilters.minPrice || '' %>">

        <input type="number" id="maxPrice" min="100" step="100" 
           class="w-1/2 border rounded p-2"
           placeholder="Max" 
           value="<%= selectedFilters.maxPrice || '' %>">
      </div>
      <button onclick="applyFilters()" 
            class="mt-3 w-full bg-blue-600 text-white py-2 rounded">Apply</button>
      </div>

        <% if (selectedFilters.brand || selectedFilters.flavour || selectedFilters.size || selectedFilters.minPrice || selectedFilters.maxPrice) { %>
          <div class="mt-6">
            <button onclick="clearFilters()" 
              class="w-full bg-gray-300 hover:bg-gray-400 text-gray-800 py-2 rounded">
              Clear Filters
            </button>
          </div>
          <% } %>
      </aside>

      <!-- Products Section -->
      <main class="flex-1">
        <div class="flex justify-between items-center mb-6">
          <p class="text-gray-600">Showing <%= products.length %> Results</p>
          <select class="border rounded p-2">
            <option>Sort by</option>
            <option>Price: Low to High</option>
            <option>Price: High to Low</option>
            <option>Price: aA-zZ</option>
            <option>Price: zZ-aA</option>
          </select>
        </div>

        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-10">
          <% products.forEach(variant => { %>
  <div class="bg-white rounded-xl shadow hover:shadow-lg transition p-4">
    <img src="<%= variant.image %>" alt="<%= variant.name %>" class="h-48 w-full object-contain mb-4">
    <h3 class="font-semibold text-lg"><%= variant.name %></h3>
    <p class="text-gray-500 text-sm">★★★★★</p>
    <p class="text-green-600 font-semibold">IN STOCK</p>
    <div class="mt-2">
      <span class="line-through text-gray-400">₹ <%= variant.original_price %></span>
      <span class="ml-2 text-xl font-bold text-gray-900">₹ <%= variant.discounted_price %></span>
    </div>
  </div>
<% }) %>

        </div>
      </main>
    </div>
  </div>
</body>
</html>

<%- include('../partials/pagination.ejs',{currentPage,totalPages}) %>

<script>

function applyFilters() {
  const params = new URLSearchParams()

  const brand = document.querySelector("select[name='brand']").value
  const flavour = document.querySelector("select[name='flavour']").value
  const size = document.querySelector("select[name='size']").value
  const minPrice = document.getElementById("minPrice").value
  const maxPrice = document.getElementById("maxPrice").value
  const category = document.querySelector("input[name='category']:checked")?.value

  if(brand && brand !== "All") params.append("brand",brand)
  if(flavour && flavour !== "All") params.append("flavour",flavour)
  if(size && size !== "All") params.append("size", size);
  if(minPrice) params.append("minPrice", minPrice);
  if(maxPrice) params.append("maxPrice", maxPrice);
  if(category && category !== "All") params.append("category",category)

  window.location.href = "/products?" + params.toString();
}

function clearFilters() {
  document.querySelector("select[name='brand']").value = "All"
  document.querySelector("select[name='flavour']").value = "All"
  document.querySelector("select[name='size']").value = "All"
  document.getElementById("minPrice").value = ""
  document.getElementById("maxPrice").value = ""
  document.querySelector("input[name='category'][value='All']").checked = true

    window.location.href = "/products"; 
}

</script>